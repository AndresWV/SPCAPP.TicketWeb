@model SPCAPP.TicketWeb.Models.Tickett
@{
    ViewData["Title"] = "Crear ticket";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container centerContainer">
    <div class="row">
        <div class="col-sm-12"><h3>Crear Ticket</h3></div>
    </div>
    <form method="post" asp-action="Create">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class="row">
            <div class="col-6">
                <div class="codigoStyle form-outline">
                    <input class="form-control" id="cod" asp-for="Id" type="number" readonly />
                    <label class="form-label" asp-for="Id">CÓDIGO</label>
                </div>
            </div>
            <div class="col-3">
                <div class="form-group">
                    <input type="date" class="form-control clickable input-md datee" asp-for="Fecha"
                           placeholder="FECHA  &#xf133;">
                </div>
            </div>
            <div class="col-3">
                <div class="md-form">
                    <input type="time" class="form-control clickable input-md datee" asp-for="Hora"
                           placeholder="HORA  &#xf107;">
                </div>
            </div>
        </div>

        <div class="w-100"></div>
        <div class="row section2Style">

            <div class="row mt-5">
                <div class="col form-outline folio" style="margin-left: 13%;">
                    <input class="form-control" id="folio" asp-for="Folio" readonly />
                    <label class="form-label" asp-for="Folio">FOLIO</label>
                </div>
                <div class="col" style="margin-right: 10%;">
                    <select class="form-select" asp-for="Estado" aria-label="Default select example">
                        <option selected>ESTADO</option>
                        <option value="1">Pendiente</option>
                        <option value="2">Terminado</option>
                        <option value="3">Nulo</option>
                    </select>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row">
                <div class="col-3 form-outline folio" style="margin-top: 3%;margin-left: 13%;">
                    <input type="text" id="clt" asp-for="Cliente" class="form-control" />
                    <label class="form-label" asp-for="Cliente">CLIENTE</label>
                </div>
                <div class="col form-outline" style="margin-top: 3%;margin-left: 1%; margin-right: 11%;">
                    <input type="text" id="ali" asp-for="Alias" class="form-control" readonly />
                    <label class="form-label" id="aliLabel" asp-for="Alias">ALIAS</label>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row">
                <div class="col form-outline folio" style="margin-top: 3%;margin-left: 13%;">
                    <input type="email" asp-for="Emailempresa" id="emailEm" class="form-control" readonly />
                    <label class="form-label" asp-for="Emailempresa">EMAIL EMPRESA</label>
                </div>
                <div class="col" style="margin-top: 3%;margin-right: 10%;">
                    <select id="cont" class="form-select" asp-for="Contacto" aria-label="Default select example">
                        <option selected>CONTACTO</option>
                        CONTACTO
                    </select>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row">
                <div class="col form-outline folio" style="margin-top: 3%;margin-left: 13%;margin-right: 3%;">
                    <input type="tel" asp-for="Telefono1" id="telefono1" class="form-control" readonly />
                    <label class="form-label" asp-for="Telefono1">TELÉFONO 1</label>
                </div>
                <div class="col form-outline folio" style="margin-top: 3%;;margin-right: 3%;">
                    <input type="tel" asp-for="Telefono2" id="telefono2" class="form-control" readonly />
                    <label class="form-label" asp-for="Telefono2">TELÉFONO 2</label>
                </div>
                <div class="col form-outline folio" style="margin-top: 3%;margin-right: 11%;">
                    <input type="tel" asp-for="Telefono3" id="telefono3" class="form-control" readonly />
                    <label class="form-label" asp-for="Telefono3">TELÉFONO 3</label>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row mb-5">
                <div class="col form-outline folio" style="margin-top: 3%;margin-left: 13%;">
                    <input type="email" asp-for="Email" id="email" class="form-control" readonly />
                    <label class="form-label" asp-for="Email">EMAIL</label>
                </div>
                <div class="col" style="margin-top: 3%;margin-right: 10%;">
                    <select class="form-select" asp-for="ModoContacto" id="medioo" aria-label="Default select example">
                        <option selected>MODO CONTACTO</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <h4 class="h3Ticket">SOLICITUD DE REQUERIMIENTOS</h4>
        </div>

        <div class="row section2Style mt-1 mb-5">

            <div class="row mt-5">
                <div class="col form-outline folio" style="margin-left: 13%;">
                    <select class="form-select" asp-for="AreaTrabajo" id="atrabj" aria-label="Default select example">
                        <option selected>ÁREA DE TRABAJO</option>
                    </select>
                </div>
                <div class="col" style="margin-right: 10%;">
                    <select class="form-select" asp-for="TipoSoporte" id="supp" aria-label="Default select example">
                        <option selected>TIPO DE SOPORTE</option>
                    </select>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row">
                <div class="col form-outline folio" style="margin-top: 3%;margin-left: 13%;">
                    <select class="form-select" id="asignadoo" asp-for="Asignado" aria-label="Default select example">
                        <option selected>ASIGNADO</option>
                        ASIGNADO
                    </select>
                </div>
                <div class="col" style="margin-top: 3%;margin-right: 10%;">
                    <select class="form-select" aria-label="Default select example" asp-for="Proyecto" style="visibility:hidden;">
                        <option selected>PROYECTO</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                    </select>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row">
                <div class="col md-form" style="margin-top: 3%;margin-left: 13%;margin-right: 10%;">
                    <textarea asp-for="ResumenTicket" class="md-textarea form-control textareaStyle" rows="3"></textarea>
                    <label asp-for="ResumenTicket">Resumen del ticket</label>
                </div>
            </div>

            <div class="w-100"></div>
            <div class="row">
                <div class="col" style="margin-top: 3%;margin-left: 43%;">
                    <p>
                        <label>
                            <input type="checkbox" class="filled-in" checked="checked" />
                            <span>AGREGAR A CALENDARIO</span>
                        </label>
                    </p>
                </div>
            </div>

            <div w-100></div>
            <div class="row mt-1 mb-5">
                <div class="col" style="margin-left: 45%;">
                    <button type="submit" class="btn btn-primary btn-lg">Crear Ticket</button>
                </div>

            </div>
        </div>
    </form>
</div>
<!--Incoorporar validacion del lado del cliente-->
@section scripts{

    <script>
        //Traer datos select modo contacto
        $.get("/Tickett/GetMContacto", function (dataMedios) {
            for (var i = 0; i < dataMedios.length; i++) {
                var option = document.createElement("option"); //Creas el elemento opción
                $(option).html(dataMedios[i].medio1); //Escribes en él el nombre de la provincia
                $(option).appendTo("#medioo"); //Lo metes en el select con id provincias
            }
        });
        //Traer los tipo de soporte
        $.get("/Tickett/GetTSoporte", function (dataSoporte) {
            for (var i = 0; i < dataSoporte.length; i++) {
                var option = document.createElement("option"); //Creas el elemento opción
                $(option).html(dataSoporte[i].tipoDes); //Escribes en él el nombre de la provincia
                $(option).appendTo("#supp"); //Lo metes en el select con id provincias
            }
        });
        //Traer los tecnicos
        $.get("/Tickett/GetTecnico", function (dataAsignados) {
            for (var i = 0; i < dataAsignados.length; i++) {
                var option = document.createElement("option"); //Creas el elemento opción
                $(option).html(dataAsignados[i].tecnicoNom); //Escribes en él el nombre de la provincia
                $(option).appendTo("#asignadoo"); //Lo metes en el select con id provincias
            }
        });
        //Traer areas de trabajo
        $.get("/Tickett/GetTKgrupos", function (dataTrabajo) {

            for (var i = 0; i < dataTrabajo.length; i++) {
                var option = document.createElement("option"); //Creas el elemento opción
                $(option).html(dataTrabajo[i].desGrupo); //Escribes en él el nombre de la provincia
                $(option).appendTo("#atrabj"); //Lo metes en el select con id provincias
            }
        });
        //Metodo para controlar el autocompletado del text input CLIENTE
        $("#clt").autocomplete({
            source: '@Url.Action("GetNombresClientes", "Tickett")',
            minlength: 2,
            position: { my: "left bottom", at: "left bottom" },
            delay: 300,
            open: function () {
                $("ul.ui-menu").width($(this).innerWidth());
            },
            classes: {
                "ui-autocomplete": "highlig"
            },
            //Cuando seleccione un elemento del menu desplegable...
            select: function (event, ui) {
                //tomar datos en base al cliente seleccionado por el autocompletado
                $.get("/Tickett/GetAlias", {term:ui.item.value} ,function (data) {
                    $(".result").html(data);
                    //cambiar código
                    $("#cod").val("" + data.codAux);
                    $('#cod').focus();
                    //cambiar folio
                    $("#folio").val("" + data.comAux);
                    $('#folio').focus();
                    //cambiar alias
                    $("#ali").val("" + data.noFaux);
                    $('#ali').focus();
                    //cambiar email empresa
                    $("#emailEm").val("" + data.eMailDte);
                    $('#emailEm').focus();
                    //cargar contactos para el select contacto
                    $.get("/Tickett/GetContactos", { term: data.codAux }, function (data2) {
                        for (var i = 0; i < data2.length; i++) {
                            var option = document.createElement("option"); //Creas el elemento opción
                            $(option).html(data2[i].nomCon); //Escribes en él el nombre de la provincia
                            $(option).appendTo("#cont"); //Lo metes en el select con id provincias
                        }
                    });
                    //cargar datos en base al contacto seleccionado
                    $("#cont").change(function () {
                        $.get("/Tickett/GetContacto", { term: $(this).val() }, function (dataContacto) {
                            //telefono1
                            $("#telefono1").val("" + dataContacto.fonCon);
                            $('#telefono1').focus();
                            //telefono2
                            $("#telefono2").val("" + dataContacto.fonCon2);
                            $('#telefono2').focus();
                            //telefono3
                            $("#telefono3").val("" + dataContacto.fonCon3);
                            $('#telefono3').focus();
                            //cambiar email empresa
                            $("#email").val("" + dataContacto.email);
                            $('#email').focus();
                        });
                    });
                });

            }
        });
        
    </script>
}

